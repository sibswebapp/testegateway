<!DOCTYPE html>
<html lang="pt">
<head>
    <script>(function(){var p=location.pathname;var b=p.indexOf("/TestAPIWEB2/")!==-1?"/TestAPIWEB2/":"/";var e=document.createElement("base");e.href=b;document.head.prepend(e);}());</script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reembolso da Compra</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="/gateway/css/gateway_css.css">
    <link rel="stylesheet" href="/navbar/css/navbar_css.css">
    <link rel="stylesheet" href="/footer/css/footer_css.css">
    <link rel="stylesheet" href="/Refund_gateway/css/Refund_gateway_css.css">
    <link rel="stylesheet" href="/popups/css/popups_css.css">

    
</head>

<body>

    <div id="navbar"></div>
    
    <!--Main - Colocar o valor do Refund-->
   <main>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header text-center d-flex justify-content-between align-items-center" style="background-color: #cae3ff;">
                <h2 style="color: #454545; margin: 0 auto;"><b>Reembolso da compra</b></h2>
                <button type="button" class="btn btn-light btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#infoModal" title="Informações">
                    <i class="fa fa-question-circle"></i>
                </button>
            </div>

            <div class="card-body">

                <!-- Transaction ID -->
                <div class="mb-3">
                    <label for="transactionID" class="form-label">
                        Transaction ID
                    </label>
                    <input 
                        type="text" 
                        class="form-control" 
                        id="transactionID" 
                        placeholder="Ex: 1234567890">
                </div>
                
                <br>

                <div class="row g-3">
                    <!-- Valor do Refund -->
                    <div class="col-md-6">
                        <label for="refundAmount" class="form-label">Valor do reembolso</label>
                        <input 
                            type="number" 
                            class="form-control" 
                            id="refundAmount" 
                            placeholder="Ex: 10.50" 
                            min="0" 
                            step="0.01">
                    </div>

                    <!-- Descrição do Refund -->
                    <div class="col-md-6">
                        <label for="refundDescription" class="form-label">Descrição</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="refundDescription" 
                            placeholder="Ex: Devolução da compra">
                    </div>
                </div>

                <!-- Botão Refund -->
                <div class="d-grid mt-4">
                    <button 
                        type="button" 
                        class="btn btn-primary btn-lg py-2"
                        onclick="refund()">
                        <i class="fa-solid fa-rotate-left me-2"></i>
                        <strong>Reembolso da compra</strong>
                    </button>
                </div>

            </div>
        </div>
    </main>


    <div id="js_index"></div>

    <!--para o corpo do debug (debug - body do checkout)-->
    <div id="debug-section" class="container my-4 d-none">
        <div class="card shadow-sm border-0">
            <div id="debug-header" class="card-header fw-bold text-white" style="background-color: #0d6efd;">
                <i class="fa fa-bug me-2"></i>Debug da Requisição
            </div>
            <div class="card-body bg-white">
                <h6 class="fw-bold">Headers da Requisição:</h6>
                <div class="bg-light rounded p-2 mb-3" style="max-height: 200px; overflow: auto;">
                    <pre id="debug-headers" class="m-0" style="white-space: pre; overflow-x: auto;">A carregar...</pre>
                </div>

                <h6 class="fw-bold">Corpo da Resposta:</h6>
                <div class="bg-light rounded p-2" style="max-height: 300px; overflow: auto;">
                    <pre id="debug-body" class="m-0" style="white-space: pre; overflow-x: auto;">A carregar...</pre>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow">
                <div class="modal-header bg-light">
                    <h5 class="modal-title">
                        <i class="fa fa-info-circle text-primary me-2"></i> Processo de Reembolso
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>
                        Nesta página pode efetuar um <b>reembolso</b> de uma transação previamente realizada.
                        Para isso, deve preencher o <b>Transaction ID</b>, o <b>valor</b> a devolver e uma breve <b>descrição</b>.
                    </p>
                    <p>
                        Após submeter o reembolso, será enviada uma requisição para a API:
                    </p>
                    <div class="text-nowrap overflow-auto" style="max-width: 100%;">
                        <p class="mb-0">
                            <span class="badge bg-success align-middle">POST</span>
                            <code class="align-middle" style="font-size: 0.70rem;">
                                https://spg.qly.site1.sibs.pt/api/v2/payments/{transactionID}/refund
                            </code>
                        </p>
                    </div>
                    <br />
                    <p>
                        O resultado da operação será apresentado no painel de <b>Debug</b> abaixo.
                        Se o reembolso for realizado com sucesso, será indicado com uma mensagem de confirmação.
                    </p>
                    <p>Para informações detalhadas, consulte a documentação oficial:</p>
                    <a href="https://www.docs.pay.sibs.com/portugal/sibs-gateway/integrations/api/integration-guide/" class="btn btn-outline-primary btn-sm" target="_blank">
                        <i class="fa fa-external-link me-1"></i> Documentação SIBS Gateway
                    </a>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>



    <!--PopUp sucesso-->
    <section id="successModal">
        <span class="overlay"></span>
        <div class="modal-box">
        <i class="fa-regular fa-circle-check icon-success"></i>
        <h2>Reembolso efetuado com sucesso!</h2>
        <p></p>

        <div class="buttons">
            <button class="close-btn">Ok, Fechar</button>
        </div>
        </div>
    </section>


    <!--PopUp Erro-->
    <section id="errorModal">
        <span class="overlay"></span>
        <div class="modal-box">
        <i class="fa-regular fa-circle-xmark icon-error"></i>
        <h2>Erro na Configuração</h2>
        <p id="errorMessage">Ocorreu um problema ao gravar as definições.</p>

        <div class="buttons">
            <button class="close-btn">Ok, Fechar</button>
        </div>
        </div>
    </section>
    

    <div id="footer"></div>

    <script>

        // Carregar o ficheiro footer
        fetch("/footer/footer_layout.html")
        .then(res => res.text())
        .then(html => {
            document.getElementById("footer").innerHTML = html;
        })
        .catch(err => console.error("Erro ao carregar footer:", err));

        // Carregar o ficheiro navbar
        fetch("/navbar/navbar_gateway_pages.html")
        .then(res => res.text())
        .then(html => {
            document.getElementById("navbar").innerHTML = html;
        })
        .catch(err => console.error("Erro ao carregar navbar:", err));

    </script>

<!--Carregar o js-->
<script src="/Refund_gateway/js/Refund_gateway_js.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
