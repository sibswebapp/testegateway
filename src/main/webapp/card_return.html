<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status do Pagamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
    <h1 class="text-center mb-4">Status do Pagamento</h1>
    <br>
    <br>
    <div id="payment-status" class="text-center"></div>

    <!-- Ícones SVG (colocados dentro do body) -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
        </symbol>
        <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </symbol>
    </svg>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            const paymentId = getQueryParam("id");
            if (!paymentId) {
                document.getElementById("payment-status").innerHTML = 
                    '<div class="alert alert-danger">ID do pagamento não encontrado.</div>';
                return;
            }

            const apiUrl = `https://spg.qly.site1.sibs.pt/api/v2/payments/${paymentId}/status`;
            const headers = {
                "Authorization": "Bearer 0276b80f950fb446c6addaccd121abfbbb.eyJlIjoiMjA1ODA5Nzc5Nzc3MyIsInJvbGVzIjoiTUFOQUdFUiIsInRva2VuQXBwRGF0YSI6IntcIm1jXCI6XCIzNjkwMDZcIixcInRjXCI6XCI4MDc2MFwifSIsImkiOiIxNzQyNTY0OTk3NzczIiwiaXMiOiJodHRwczovL3FseS5zaXRlMS5zc28uc3lzLnNpYnMucHQvYXV0aC9yZWFsbXMvUUxZLk1FUkNILlBPUlQxIiwidHlwIjoiQmVhcmVyIiwiaWQiOiJGRXZCOTh6WHMyMzU4NzE5MDFjYzkxNDRkMTgzZTc2MDQ1NWUzMmYzYmMifQ==.a58e334057e8e792127de95c6c12d41ba7fcd42361d7ef2ea87749a276192ead72ccfda4a98091f192bd7b3576e27d39b27c1e972d1b34a761540400535ea193",
                "X-IBM-Client-Id": "9bbac851-6948-4c4e-9145-b45ef913f8d3",
                "Content-Type": "application/json",
                "Accept": "application/json"
            };

            try {
                const response = await fetch(apiUrl, {
                    method: "GET",
                    headers: headers
                });

                if (!response.ok) {
                    throw new Error(`Erro na requisição: ${response.status}`);
                }

                const data = await response.json();

                if(data.paymentStatus === "Success"){
                    document.getElementById("payment-status").innerHTML = 
                    `<div class="alert alert-success d-flex flex-column align-items-center text-center" role="alert">
                        <svg class="bi mb-2" width="50" height="50" role="img" aria-label="Success:">
                            <use href="#check-circle-fill"/>
                        </svg>
                        <div>
                            <strong>Status do pagamento:</strong> ${data.paymentStatus}
                        </div>
                    </div>`;
                } else {
                    document.getElementById("payment-status").innerHTML = 
                    `<div class="alert alert-danger d-flex flex-column align-items-center text-center" role="alert">
                        <svg class="bi mb-2" width="50" height="50" role="img" aria-label="Erro:">
                            <use href="#exclamation-triangle-fill"/>
                        </svg>
                        <div>
                            <strong>Status do pagamento:</strong> ${data.paymentStatus}
                        </div>
                    </div>`;
                }
                
            } catch (error) {
                console.error("Erro ao buscar status do pagamento:", error);
                document.getElementById("payment-status").innerHTML = 
                    '<div class="alert alert-danger">Erro ao buscar status do pagamento.</div>';
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
