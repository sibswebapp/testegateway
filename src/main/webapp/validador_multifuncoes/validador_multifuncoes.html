<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Validador Multi-funções</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="/validador_multifuncoes/css/validador_multifuncoes_css.css">
  <link rel="stylesheet" href="/popups/css/popups_css.css">
  <link rel="stylesheet" href="/navbar/css/navbar_css.css">
  <link rel="stylesheet" href="/footer/css/footer_css.css">

</head>

<body>

  <div id="navbar"></div>

  <main class="container main-container">

    <div class="card p-4 mb-4 shadow-sm rounded-3">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label fw-bold small text-muted">Terminal ID</label>
          <input type="text" id="terminalId" class="form-control" placeholder="Introduza o Terminal ID">
        </div>
        <div class="col-md-4">
          <label class="form-label fw-bold small text-muted">Client ID</label>
          <input type="text" id="clientId" class="form-control" placeholder="Introduza o Client ID">
        </div>
        <div class="col-md-4">
          <label class="form-label fw-bold small text-muted">Bearer Token</label>
          <input type="password" id="bearerToken" class="form-control" placeholder="Introduza o Token">
        </div>
      </div>
    </div>

    <ul class="nav nav-tabs" id="multiFunctionTabs" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" id="status-tab" data-bs-toggle="tab" data-bs-target="#status" type="button" role="tab">
          <i class="fas fa-search me-2"></i>GET Status
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="mit-tab" data-bs-toggle="tab" data-bs-target="#mit" type="button" role="tab">
          <i class="fas fa-credit-card me-2"></i>MIT / CIT
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="pa-tab" data-bs-toggle="tab" data-bs-target="#pagamentos_auto" type="button" role="tab">
          <i class="fas fa-handshake me-2"></i>Pagamentos Autorizados
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="paga_refund-tab" data-bs-toggle="tab" data-bs-target="#pagamentos_refund" type="button" role="tab">
          <i class="fas fa-undo me-2"></i>Refund
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="paga_cancel-tab" data-bs-toggle="tab" data-bs-target="#pagamentos_cancel" type="button" role="tab">
          <i class="fas fa-times-circle me-2"></i>Cancelamento
        </button>
      </li>
    </ul>

    <div class="tab-content" id="multiFunctionTabsContent">

      <div class="tab-pane fade show active" id="status" role="tabpanel">
        <div class="card p-4 rounded-3">
          <div class="row align-items-end g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label fw-bold">Transaction ID</label>
              <input type="text" id="statusTransactionId" class="form-control" placeholder="Ex: 123456...">
            </div>
            <div class="col-md-3">
              <button class="btn btn-primary w-100" onclick="getStatusPagamento()">
                Ver Status <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <div class="card bg-light border-0">
                <div class="card-body">
                  <h6 class="text-muted small text-uppercase fw-bold">Resumo</h6>
                  <p class="mb-1">Status: <span id="statusPagamento" class="badge bg-info">-</span></p>
                  <p class="mb-0">Code: <span id="statusCode" class="fw-bold">-</span></p>
                </div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="card border-0">
                <div class="card-header border-0 pb-0">Body Completo</div>
                <div class="card-body">
                  <pre id="bodyCompletoStatus">-</pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="mit" role="tabpanel">
        <div class="card p-4 rounded-3 border-primary border-top border-4">
          <h5 class="mb-3 text-primary fw-bold">MIT (Cobrança)</h5>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Transaction ID</label>
              <input type="text" id="mitTransactionId" class="form-control">
            </div>
            <div class="col-md-3">
              <label class="form-label">Valor</label>
              <input type="number" id="mitValor" class="form-control">
            </div>
            <div class="col-md-3">
              <label class="form-label">Tipo</label>
              <select id="mitType" class="form-select">
                <option value="UCOF">UCOF</option>
                <option value="RCSS">Recorrente</option>
              </select>
            </div>
            <div class="col-md-3 d-flex gap-2 align-items-end">
              <button class="btn btn-success flex-grow-1" onclick="fazerMIT()">MIT</button>
              <button class="btn btn-warning flex-grow-1" onclick="fazerCIT()">CIT</button>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6"><pre id="bodyCompletoMIT">-</pre></div>
            <div class="col-md-6">
              <div class="p-3 bg-light rounded">
                <p class="small mb-1">Status: <span id="mitStatus" class="fw-bold">-</span></p>
                <p class="small mb-0">Mensagem: <span id="mitMsg">-</span></p>
              </div>
            </div>
          </div>
        </div>

        <div class="card p-4 rounded-3 border-secondary border-top border-4 mt-4">
          <h5 class="mb-3 text-secondary fw-bold">Captura / CIT</h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Transaction ID MIT</label>
              <input type="text" id="captureTransactionId" class="form-control" readonly>
            </div>
            <div class="col-md-4">
              <label class="form-label">Valor da Captura</label>
              <input type="number" id="captureValor" class="form-control">
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <button class="btn btn-dark w-100" onclick="fazerCIT()">Executar Captura</button>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6"><pre id="bodyCompletoCIT">-</pre></div>
            <div class="col-md-6">
              <div class="p-3 bg-light rounded">
                <p class="small mb-1">Status: <span id="captureStatus" class="fw-bold">-</span></p>
                <p class="small mb-0">Mensagem: <span id="captureMsg">-</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="pagamentos_auto" role="tabpanel">
        <ul class="nav nav-pills sub-tabs mb-4" role="tablist">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pa-consulta">Criar Mandato</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#pa-checkout">Checkout</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#pa-compra">Pedido de Compra</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#listar_mandatos">Listar</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#mandato_detalhes">Detalhes</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#mandato_cancelar">Cancelar</button></li>
        </ul>

        <div class="tab-content p-3 bg-white border rounded">
          <div class="tab-pane fade show active" id="pa-consulta">
              <h6>Configuração de Mandato</h6>
              <div class="row g-3">
                <div class="col-md-4"><label class="form-label">Phone</label><input type="text" id="paPhone" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Name</label><input type="text" id="paCustomerName" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Merchant ID</label><input type="text" id="paMerchantTransactionId" class="form-control"></div>
              </div>
              <button class="btn btn-primary mt-3" onclick="consultarPagamentosAutorizados()">Consultar</button>
              <pre class="mt-3" id="paResultado">Log de resultado...</pre>
          </div>

          <div class="tab-pane fade" id="pa-checkout">
              <h6>Execução de Checkout</h6>
              <div class="row g-3">
                <div class="col-md-4"><label class="form-label">Mandate ID</label><input type="text" id="checkoutMandateId" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Merchant ID</label><input type="text" id="checkoutMerchantTransactionId" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Customer Name</label><input type="text" id="checkoutCustomerName" class="form-control"></div>
              </div>
              <button class="btn btn-primary mt-3" onclick="executarCheckoutMandate()">Executar Checkout</button>
              <pre class="mt-3" id="checkoutResultado">Log de resultado...</pre>
          </div>

          <div class="tab-pane fade" id="pa-compra">
              <h6>Nova Compra</h6>
              <div class="row g-3">
                <div class="col-md-4"><label class="form-label">Amount</label><input type="number" id="compraAmount" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Merchant ID</label><input type="text" id="compraMerchantTransactionId" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">Name</label><input type="text" id="compraCustomerName" class="form-control"></div>
              </div>
              <button class="btn btn-primary mt-3" onclick="executarCompra()">Executar Compra</button>
              <pre class="mt-3" id="compraResultado">Log de resultado...</pre>
          </div>

          <div class="tab-pane fade" id="listar_mandatos">
            <button class="btn btn-outline-primary" onclick="executarCompra()">Listar Mandatos</button>
          </div>
          <div class="tab-pane fade" id="mandato_detalhes">
            <button class="btn btn-outline-primary" onclick="executarCompra()">Ver Detalhes</button>
          </div>
          <div class="tab-pane fade" id="mandato_cancelar">
            <button class="btn btn-outline-danger" onclick="executarCompra()">Cancelar Mandato</button>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="pagamentos_refund" role="tabpanel">
        <div class="card p-4 rounded-3">
          <h5 class="fw-bold mb-3"><i class="fas fa-undo me-2"></i>Solicitar Reembolso</h5>
          <div class="row g-3 align-items-end">
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Transaction ID"></div>
            <div class="col-md-3"><button class="btn btn-primary w-100">Ver Status</button></div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="pagamentos_cancel" role="tabpanel">
        <div class="card p-4 rounded-3">
          <h5 class="fw-bold mb-3 text-danger"><i class="fas fa-ban me-2"></i>Anular Operação</h5>
          <div class="row g-3 align-items-end">
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Transaction ID"></div>
            <div class="col-md-3"><button class="btn btn-danger w-100">Cancelar</button></div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content card">
        <div class="modal-box">
          <i class="fa-regular fa-circle-check icon-success"></i>
          <h3>Configuração Guardada</h3>
          <p>As suas definições foram gravadas com sucesso.</p>
          <button class="btn btn-success" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errorModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content card">
        <div class="modal-box">
          <i class="fa-regular fa-circle-xmark icon-error"></i>
          <h3>Erro na Configuração</h3>
          <p id="errorMessage">Ocorreu um problema ao gravar as definições.</p>
          <button class="btn btn-danger" data-bs-dismiss="modal">Tentar Novamente</button>
        </div>
      </div>
    </div>
  </div>

  <div id="footer"></div>

  <div id="js_index"></div>

  <!--PopUp sucesso-->
  <section id="successModal">
    <span class="overlay"></span>
    <div class="modal-box">
      <i class="fa-regular fa-circle-check icon-success"></i>
      <h2>Configuração Guardada</h2>
      <p>As suas definições foram gravadas com sucesso.</p>

      <div class="buttons">
        <button class="close-btn">Ok, Fechar</button>
      </div>
    </div>
  </section>


  <!--PopUp Erro-->
  <section id="errorModal">
    <span class="overlay"></span>
    <div class="modal-box">
      <i class="fa-regular fa-circle-xmark icon-error"></i>
      <h2>Erro na Configuração</h2>
      <p id="errorMessage">Ocorreu um problema ao gravar as definições.</p>

      <div class="buttons">
        <button class="close-btn">Ok, Fechar</button>
      </div>
    </div>
  </section>


  <script>

    // Carregar o ficheiro footer
    fetch("/footer/footer_layout.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer").innerHTML = html;
    })
    .catch(err => console.error("Erro ao carregar footer:", err));

    // Carregar o ficheiro navbar
    fetch("/navbar/navbar_Onboarding_pages.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("navbar").innerHTML = html;
    })
    .catch(err => console.error("Erro ao carregar navbar:", err));

  </script>

  <!--Carregar o js-->
  <script src="/validador_multifuncoes/js/validador_multifuncoes.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.js"></script>

</body>
</html>