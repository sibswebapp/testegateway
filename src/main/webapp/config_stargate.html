<!DOCTYPE html>
<html lang="pt">

<head>
  <script>(function(){var p=location.pathname;var b=p.indexOf("/TestAPIWEB2/")!==-1?"/TestAPIWEB2/":"/";var e=document.createElement("base");e.href=b;document.head.prepend(e);}());</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configuração do Terminal</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"></linkhref>
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

  <style>
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
          background: #f0f0f0;
          color: #333;
          font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }

        /*navbar css*/
        .navbar {
            background-color: #fff !important;
            padding-top: 0.2rem;
            padding-bottom: 0.2rem;
            min-height: 55px; 
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); 
        }

        .navbar .navbar-brand img {
            max-height: 30px; 
            width: auto;
        }

        /*footer css*/
        footer {
            background-color: #fff;
            color: #333;
            padding: 20px 0;
            font-size: 0.9rem;
            text-align: center;
            margin-top: auto;
        }

        footer a.btn {
            font-size: 0.85rem;
            padding: 6px 14px;
        }

        footer a {
            color: #4c1d95;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        main {
          flex: 1 0 auto;
        }

        /*letra css*/
        h2 {
          font-weight: bold;
        }

        /* POPUP - DESIGN (sucesso) */
        /* Overlay escuro */
        #successModal .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.6);
          opacity: 0;
          visibility: hidden;
          transition: 0.3s ease-in-out;
          z-index: 9998;
        }

        /* Caixa do modal */
        #successModal .modal-box {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%) scale(0.8);
          background: #fff;
          border-radius: 16px;
          padding: 30px 25px;
          width: 400px;
          max-width: 90%;
          text-align: center;
          box-shadow: 0 10px 30px rgba(0,0,0,0.2);
          opacity: 0;
          visibility: hidden;
          transition: 0.3s ease-in-out;
          z-index: 9999;
        }

        /* Ícone de sucesso */
        #successModal .icon-success {
          font-size: 60px;
          color: #28a745;
          margin-bottom: 15px;
        }

        /* Título */
        #successModal h2 {
          margin: 10px 0 5px;
          font-size: 22px;
          font-weight: bold;
          color: #333;
        }

        /* Texto */
        #successModal p {
          font-size: 15px;
          color: #666;
          margin-bottom: 20px;
        }

        /* Botão */
        #successModal .buttons .close-btn {
          background: #28a745;
          border: none;
          color: #fff;
          padding: 10px 18px;
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }
        #successModal .buttons .close-btn:hover {
          background: #218838;
        }

        /* Estado ativo (mostra o modal) */
        #successModal.active .overlay {
          opacity: 1;
          visibility: visible;
        }
        #successModal.active .modal-box {
          opacity: 1;
          visibility: visible;
          transform: translate(-50%, -50%) scale(1);
        }



        /* POPUP - DESIGN (ERRO) */
        /* Overlay do erro */
        #errorModal .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.6);
          opacity: 0;
          visibility: hidden;
          transition: 0.3s ease-in-out;
          z-index: 9998;
        }

        /* Caixa do modal */
        #errorModal .modal-box {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%) scale(0.8);
          background: #fff;
          border-radius: 16px;
          padding: 30px 25px;
          width: 400px;
          max-width: 90%;
          text-align: center;
          box-shadow: 0 10px 30px rgba(0,0,0,0.2);
          opacity: 0;
          visibility: hidden;
          transition: 0.3s ease-in-out;
          z-index: 9999;
        }

        /* Ícone de erro */
        #errorModal .icon-error {
          font-size: 60px;
          color: #dc3545; /* Vermelho Bootstrap */
          margin-bottom: 15px;
        }

        /* Título */
        #errorModal h2 {
          margin: 10px 0 5px;
          font-size: 22px;
          font-weight: bold;
          color: #333;
        }

        /* Texto */
        #errorModal p {
          font-size: 15px;
          color: #666;
          margin-bottom: 20px;
        }

        /* Botão */
        #errorModal .buttons .close-btn {
          background: #dc3545;
          border: none;
          color: #fff;
          padding: 10px 18px;
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }
        #errorModal .buttons .close-btn:hover {
          background: #c82333;
        }

        /* Estado ativo */
        #errorModal.active .overlay {
          opacity: 1;
          visibility: visible;
        }
        #errorModal.active .modal-box {
          opacity: 1;
          visibility: visible;
          transform: translate(-50%, -50%) scale(1);
        }

    </style>
</head>

<body>

  <!--Nav bar-->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid d-flex justify-content-between align-items-center px-4">
      <a class="navbar-brand d-flex align-items-center"  href="#" data-back-button>
        <img src="https://www.pay.sibs.com/wp-content/uploads/2022/02/logo.png" alt="Logo SIBS" style="max-height:30px;">
      </a>
      <div>
        <a class="btn btn-rounded" data-back-button style="background-color: #ff9800; color:#f2f2f2;">
          <i class="fa fa-reply"></i> Voltar atrás
        </a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <br>
      <br>
    <div class="card">
      <div class="card-header text-center d-flex justify-content-between align-items-center" style="background-color: #e65100;">
        <h2 style="color: #f2f2f2; margin: 0 auto;"><b>Gateway SIBS - Configuração</b></h2>
      </div>
      <div class="card-body">

        <!--Checkboxs-->
        <div class="d-flex align-items-center mb-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="defaultToggle" onchange="toggleDefaults(this);">
            <label class="form-check-label" for="defaultToggle">Usar Terminal default</label>
          </div>
          <div class="form-check form-switch ms-4">
              <input class="form-check-input" type="checkbox" id="AllMethodsPay" onchange="toggleAllMethodsPay(this)">
              <label class="form-check-label" for="AllMethodsPay">Usar todos os métodos de pagamento</label>
          </div>
        </div>


        <!--Inputs para preencher-->
        <div class="mb-4" id="inputTerminalId_stargate">
          <label for="terminalId_stargate" class="form-label">Terminal ID:</label>
          <input type="number" id="terminalId_stargate" class="form-control" placeholder="Insira o terminalID fornecido pela SIBS">
        </div>

        <div class="mb-4" id="inputClientId_stargate">
          <label for="clientId_stargate" class="form-label">Client ID:</label>
          <input type="text" id="clientId_stargate" class="form-control" placeholder="Insira o ClientID fornecido pela SIBS">
        </div>

        <div class="mb-4" id="inputBearerToken_stargate">
          <label for="bearerToken_stargate" class="form-label">Bearer Token:</label>
          <textarea id="bearerToken_stargate" class="form-control" rows="4" placeholder="Insira o Bearer Token"></textarea>
        </div>

        <button class="btn w-100" onclick="saveConfig()" style="background-color: rgb(255, 152, 0); color: rgb(242, 242, 242);">Guardar Configuração</button>
      </div>
    </div>
  </div>
  <br>

  <!--footer-->
  <footer>
    <div class="container">
      <p class="mb-1">© 2025 Pagamentos SIBS. Todos os direitos reservados.</p>
    </div>
  </footer>

  <!--PopUp sucesso-->
  <section id="successModal">
    <span class="overlay"></span>
    <div class="modal-box">
      <i class="fa-regular fa-circle-check icon-success"></i>
      <h2>Configuração Guardada</h2>
      <p>As suas definições foram gravadas com sucesso.</p>

      <div class="buttons">
        <button class="close-btn">Ok, Fechar</button>
      </div>
    </div>
  </section>


  <!--PopUp Erro-->
  <section id="errorModal">
    <span class="overlay"></span>
    <div class="modal-box">
      <i class="fa-regular fa-circle-xmark icon-error"></i>
      <h2>Erro na Configuração</h2>
      <p id="errorMessage">Ocorreu um problema ao gravar as definições.</p>

      <div class="buttons">
        <button class="close-btn">Ok, Fechar</button>
      </div>
    </div>
  </section>

  <script>

    // PopUP de sucesso chamada
    const successModal = document.getElementById("successModal"),
          overlay = successModal.querySelector(".overlay"),
          closeBtn = successModal.querySelector(".close-btn");

    function showSuccessModal() {
      successModal.classList.add("active");
    }

    overlay.addEventListener("click", () => successModal.classList.remove("active"));
    closeBtn.addEventListener("click", () => successModal.classList.remove("active"));


    // PopUP de erro chamada
    const errorModal = document.getElementById("errorModal"),
          errorOverlay = errorModal.querySelector(".overlay"),
          errorCloseBtn = errorModal.querySelector(".close-btn");

    function showErrorModal(message) {
      errorMessage.textContent = message;
      errorModal.classList.add("active");
    }

    errorOverlay.addEventListener("click", () => errorModal.classList.remove("active"));
    errorCloseBtn.addEventListener("click", () => errorModal.classList.remove("active"));


    //Função para mascarar string
    function maskValue(value) {
      if (!value) return "";
      value = String(value);
      return value.substring(0, 4) + "****";
    }

    //Buscar localStorage arrays
    const credentialDefaultObj = JSON.parse(localStorage.getItem('credential_default_stargate'));
    const credential_config_variable = JSON.parse(localStorage.getItem('credential_config_stargate'))
    const default_Configs = JSON.parse(localStorage.getItem('default_stargate'))


    function toggleDefaults(checkbox) {
      const terminal = document.getElementById('terminalId_stargate');
      const client = document.getElementById('clientId_stargate');
      const token = document.getElementById('bearerToken_stargate');

      const inputs = ['inputTerminalId_stargate', 'inputClientId_stargate', 'inputBearerToken_stargate'];

      if(checkbox.checked) {

        terminal.value = credentialDefaultObj.terminalId;
        client.value = credentialDefaultObj.clientId;
        token.value = credentialDefaultObj.bearerToken;
        
        inputs.forEach(id => document.getElementById(id).classList.add('d-none'));
        
      } else {
        terminal.value = '';
        client.value = '';
        token.value = '';

        inputs.forEach(id => document.getElementById(id).classList.remove('d-none'));
      }

    }

    function saveConfig() {
      const useDefault = document.getElementById('defaultToggle').checked;
      const AllMethodsPay = document.getElementById('AllMethodsPay').checked ? 1 : 0;

      let terminal = document.getElementById('terminalId_stargate').value;
      let client = document.getElementById('clientId_stargate').value;
      let token = document.getElementById('bearerToken_stargate').value;

      if (!terminal) {
        showErrorModal("Preencha o campo do Terminal.");
        return;
      }

      if (!client) {
        showErrorModal("Preencha o campo do Client ID.");
        return;
      }

      if (!token) {
        showErrorModal("Preencha o campo do Bearer Token.");
        return;
      }
      
      if (!useDefault && (!terminal || !client || !token)) {
        showErrorModal("Preencha todos os campos obrigatórios.");
        return;
      }

      if(useDefault){
        terminal = credentialDefaultObj.terminalId;
        client = credentialDefaultObj.clientId;
        token = credentialDefaultObj.bearerToken;
      }

      const credential_obj = {
        terminalId: terminal,
        clientId: client,
        bearerToken: token,
        useDefaultConfig: useDefault.toString(),
        AllMethodsPay: AllMethodsPay,
      };

      localStorage.setItem('credential_config_stargate', JSON.stringify(credential_obj));
      localStorage.setItem('default_stargate', '0');

      showSuccessModal();
    }

    function restoreFromLocalStorage() {
      const useDefault = default_Configs;
      const checkbox = document.getElementById('defaultToggle');

      let checkbox_option
      let AllMethodsPay


      if(useDefault == "1"){
        checkbox_option = credentialDefaultObj.useDefaultConfig;
        AllMethodsPay = credentialDefaultObj.AllMethodsPay;
      }else{
        checkbox_option = credential_config_variable.useDefaultConfig;
        AllMethodsPay = credential_config_variable.AllMethodsPay;
      }

      checkbox.checked = checkbox_option === "true" || checkbox_option === true || checkbox_option === 1 || checkbox_option === "1" ;

      toggleDefaults(checkbox);

      if (!useDefault) {
        document.getElementById('terminalId_stargate').value = credential_config_variable.terminalId || '';
        document.getElementById('clientId_stargate').value = credential_config_variable.clientId || '';
        document.getElementById('bearerToken_stargate').value = credential_config_variable.bearerToken || '';
      }

      if (AllMethodsPay == 1) {
        document.getElementById("AllMethodsPay").checked = true;
      } else {
        document.getElementById("AllMethodsPay").checked = false;
      }

    }

    document.querySelectorAll('[data-back-button]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();

        const useDefault = document.getElementById('defaultToggle').checked;
        const terminal = document.getElementById('terminalId_stargate').value;
        const client = document.getElementById('clientId_stargate').value;
        const token = document.getElementById('bearerToken_stargate').value;
      
        const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');

        window.location.href = window.location.pathname.replace(/[^/]*$/, '') + 'Stargate.html';

      });
    });

    window.addEventListener('DOMContentLoaded', restoreFromLocalStorage);


    document.addEventListener("DOMContentLoaded", async function () {

      let baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, ''); 

      window.addEventListener("popstate", function () {
        baseUrl = "Stargate.html" + novaURL;
      });

    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.js"></script>

</body>
</html>
